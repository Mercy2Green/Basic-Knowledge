# 进程与线程
## 进程的概念和特征

进程的四个特征：动态性（程序的一次执行过程）、并发性（多个进程实体同时存在于内存中，在一定时间内同时运行）、独立性（资源和调度的基本单位）、异步性（进程间异步导致不可再现性和需要同步）。

## 进程的状态与转换

进程的状态：就绪态、运行态、阻塞态、创建态、结束态。前三个是基本状态。注：进行从*运行态->阻塞态*是**主动行为**，从*阻塞态->就绪态*是**被动行为**。

## 进程的组织形式

进程组织形式有三个部分：PCB、程序段、数据段。

一个进程有一个*PCB*，该结构在进程创建之后常驻内存，在进程结束之后删除，是进程存在的唯一标志。有两种组织模式：链接和索引。

**程序段**指的是调度到CPU中执行的程序代码段。可以共享使用。

## 进程通信

三个方式：共享存储（数据结构、存储区）、消息传递（可以理解为tcp，udp）、管道通信（一种定长共享文件，半双工通信方式）。

## 线程与多线程

### 概述

有两个主要的好处（减小开销、实现并行（非并行））

引入线程后，线程作为CPU基本执行单元，独立的调度单位（所以如果设计多线程，那么就会说线程是基本调度单位（多线程操作系统），之前说的是进程（传统操作系统）。），但线程不独立拥有资源，进程依然是基本的资源分配单位。

线程引入后，切换线程时就会比切换进程开销更小，提高系统的并发性。

注：“之前问：即使进程没换，也是进行了切换，那么来回切换线程也是需要很多切换开销啊，这和切换进程有啥区别吗？”（2022年3月14日）：进程是会分配资源的，首先就是资源和执行单元都会切换，而仅切换线程，就只需要切换执行单元。并且，引入线程后，可以将原本多进程能完成的功能利用一个进程的多线程完成，在一个进程中就可以实现更小开销的资源共享、信息传递和处理操作。此外，多处理机系统可以并行多线程进程，提升效率。

### 用户级线程、内核级线程、组合模式

仅用户级线程：线程的操作由用户程序完成，节省“用户态-内核态”转换开销。但是容易造成“多线程-单处理机”、“多线程-单进程-该进程阻塞”等问题。就降低并发或不能并行了。

仅内核级线程：由操作系统来管理线程。可以实现并发、并行，减少因进程阻塞而导致的该进程全部线程的阻塞。但是开销大。

组合模式：结合二者优势。

注：C++中Windows的thread()是内核级线程、POSIX的pthread()是用户级线程和内核级线程。

线程库：利用线程库来操作，三种主要的线程库：POSIX Pthreads、Windows API、JAVA。Java的比较特殊，本来是用户级线程，允许Java进程创建线程。但是Java的JVM实例运行在宿主操作系统上。所以就跟着宿主系统是啥就是啥级别的线程。

线程系统调用阻塞时，在多对1用户级线程模型下，会导致所属进程阻塞。
在1对1内核级或多对多两级模型下，不会导致线程阻塞使得进程阻塞问题的发生。
